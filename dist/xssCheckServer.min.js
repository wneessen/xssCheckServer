"use strict";var wpObj=require("webpage").create(),wsObj=require("webserver").create(),sysObj=require("system"),versionNum="1.0.6",debugMode=!1;wpObj.settings.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36 xssCheckServer/"+versionNum,wpObj.settings.XSSAuditingEnabled=!1,wpObj.settings.webSecurityEnabled=!1,wpObj.settings.loadImages=!0,wpObj.settings.javascriptEnabled=!0,wpObj.settings.localToRemoteUrlAccessEnabled=!0,wpObj.settings.resourceTimeout=5e3;var resBlackList=["googletagmanager.com","google-analytics.com","optimizely.com",".amazon-adsystem.com","device-metrics-us.amazon.com","crashlytics.com","doubleclick.net"],listenHost="127.0.0.1",listenPort="8099",cliArgs=sysObj.args;cliArgs.forEach(function(e,s){if(e.match(/^-/)&&"-"!==e){var o=cliArgs[s],t=cliArgs[s+1];"-h"===o&&(console.log("Usage: "+sysObj.args[0]+" [-l 127.0.0.1 -p 8099]"),phantom.exit(0)),"-l"===o&&(listenHost=t),"-p"===o&&(listenPort=t),"-d"===o&&(debugMode=!0)}}),console.log("This is xssCheckServer v"+versionNum),console.log("Starting webserver on http://"+listenHost+":"+listenPort);var webService=wsObj.listen(listenHost+":"+listenPort,function(e,s){var o=new Date,t=Date.now(),n="XSSed!",r={hasXss:!1,xssData:[],blockedUrls:[],checkUrl:"",checkTime:o,searchString:"",alertOnAnyEvent:!1,requestTime:0},l=function(e,s){debugMode&&(console.log("An event has been executed on "+i),console.log('==> EventType: "'+e+'" // EventData: "'+s+'"')),s!==n&&!0!==r.alertOnAnyEvent||(debugMode&&console.log('Possible XSS! The eventMsg matches the search string: "'+n+'"\n'),r.hasXss=!0,r.xssData.push({eventType:e,eventMsg:s}))};if(wpObj.onAlert=function(e){l("alert()",e)},wpObj.onConfirm=function(e){l("confirm()",e)},wpObj.onConsoleMessage=function(e){l("console.log()",e)},wpObj.onPrompt=function(e){l("prompt()",e)},wpObj.onError=debugMode?function(e){console.error("An error was caught: "+e)}:function(){},wpObj.onResourceRequested=function(e,s){var o=function(s){var o=new RegExp(s,"g");return e.url.match(o)};resBlackList.some(o)&&(debugMode&&console.log(e.url+" is blacklisted. Not loading resource."),r.blockedUrls.push(e.url),s.abort())},debugMode&&(console.log("Received new HTTP request"),console.log("Method: "+e.method),console.log("Path: "+e.url),e.post&&console.log("postData: "+JSON.stringify(e.post)),console.log(" ")),"/check"===e.url)if("POST"===e.method)if(e.post.searchfor&&(n=e.post.searchfor,r.searchString=n),e.post.everyevent&&"true"===e.post.everyevent&&(r.alertOnAnyEvent=!0),e.post.url){var i=e.post.url;r.checkUrl=i,wpObj.open(i,function(e){t=Date.now()-t,"success"!==e?console.error("Unable to download URL: "+i):wpObj.evaluate(function(){}),r.requestTime=t,debugMode&&console.log("Request completed in "+t/1e3+" sec"),s.statusCode=200,s.write(JSON.stringify(r)),s.close()})}else s.statusCode=400,r.errorMsg="Missing data",s.write(JSON.stringify(r)),s.close();else s.statusCode=404,r.errorMsg="Invalid request method",s.write(JSON.stringify(r)),s.close();else s.statusCode=404,r.errorMsg="Route not found",s.write(JSON.stringify(r)),s.close()});